import socket

from appJson import run

print("стартуем сервер")
sock = socket.socket()
sock.bind(('', 9090))
sock.listen(1)
conn, addr = sock.accept()

print('connected:', addr)
listOfbooks = []
while True:
    data = conn.recv(1024)
    print(data)
    if not data:
        print("not data")
        break
    if data == b"add":
        print("будем добавлять книгу. Все данные у клиента уже подготовленны")
        paramsstr = conn.recv(1024)
        paramsstr = str(paramsstr, "utf-8")
        msg = run(str(data.decode("utf-8")),listOfbooks, paramsstr)
        conn.send(bytearray(msg,"utf-8"))
        continue
    else:
        msg = run(str(data.decode("utf-8")), listOfbooks, "")
        print("msg from func: " + msg)
        conn.send(bytearray(msg, "utf-8"))
        #conn.send(bytearray(str(data.upper()) + "    "+ msg +"   abc", "utf-8"))


conn.close()